import math
import scipy.stats as stats

"""
ЗАДАЧА N: MDE
ЦЕЛЬ: Рассчитать необходимый размер выборки для дизайна эксперимента.
МЕТОД: Дизайн эксперимента с использованием оценок матожидания и дисперсии из задачи M. 
       Параметры: обнаружение эффекта в 1% при alpha = 0.05 и beta = 0.20. 
       Соотношение групп 1 к 3 (контроль в 3 раза больше теста). 
       Округление итогового количества пользователей производится вверх (math.ceil).
"""

# Данные из предыдущей задачи M
# Эти значения являются несмещенными оценками матожидания и дисперсии
mu = 2750.847
var = 3646228.409

# Параметры дизайна эксперимента
alpha = 0.05       # Вероятность ошибки первого рода
beta = 0.20        # Вероятность ошибки второго рода (мощность теста 80%)
effect_pct = 0.01  # Ожидаемый эффект 1%
k = 3              # Соотношение групп: контроль в 3 раза больше теста

# Расчет вспомогательных величин
effect = effect_pct * mu
sigma = var ** 0.5

# Квантили нормального распределения
z_alpha = stats.norm.ppf(1 - alpha / 2)
z_beta = stats.norm.ppf(1 - beta)

# Расчет размера выборки
m = ((z_alpha + z_beta) ** 2) * (1 + k) * (sigma ** 2) / (effect ** 2)

m_ceil = math.ceil(m)          # Размер контрольной группы
n_ceil = math.ceil(m_ceil / k) # Размер тестовой группы

# Итоговое количество пользователей
total_users = m_ceil + n_ceil

print(total_users)